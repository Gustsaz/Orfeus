<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#ff6b35">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Orfeus">
  <title>Orfeus - Home</title>
  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="imgs/orfeus_logo.png">
  <link rel="icon" type="image/png" sizes="16x16" href="imgs/orfeus_logo.png">
  <link rel="apple-touch-icon" href="imgs/orfeus_logo.png">
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">

  <link rel="stylesheet" href="style.css">
  <script src="https://unpkg.com/tone@14.8.39/build/Tone.js"></script>
</head>

<body>
  <div class="topbar">
    <div class="ticker">NEWS — Bem-vindo ao Orfeus: novas aulas e desafios semanais!</div>
  </div>

  <header class="site-header">
    <div class="site-header">
      <div class="brand">
        <img src="imgs/logo_img.png" alt="Logo" class="logo-img">
      </div>

      <div class="header-right">
        <!-- Menu de acessibilidade -->
        <div class="accessibility-menu">
          <button id="accessibility-toggle" aria-label="Abrir menu de acessibilidade">
            <img src="imgs/accessibility-icon.png" alt="Acessibilidade" />
          </button>
          <div id="accessibility-options" class="hidden">
            <button id="font-increase">A+</button>
            <button id="font-decrease">A-</button>
            <button id="screen-reader">Ler</button>
            <button id="colorblind-toggle">Daltonismo</button>
          </div>
        </div>

        <div id="auth-ui"></div>
        <div id="user-info" style="display:none;">
          <img src="" alt="Foto de perfil" id="user-photo">
          <span id="user-name"></span>
          <span class="user-points" id="user-points"></span>
          <div class="user-actions">
            <button class="edit-profile-btn">Editar</button>
            <button id="logout-btn">Sair</button>
          </div>
        </div>
      </div>
    </div>

  </header>

  <main class="main-panel">

    <!-- 🔹 Logo Placeholder -->
    <div class="logo">
      <h1>Orfeus</h1>
    </div>

    <!-- 🔹 Menu hamburguer para mobile -->
    <div class="tabs-menu">
      <button id="tabs-toggle">☰ Menu</button>
      <div class="tabs-dropdown" id="tabsDropdown">
        <button class="tab-btn" data-tab="home">Homepage</button>
        <button class="tab-btn" data-tab="afinador">Afinador</button>
        <button class="tab-btn" data-tab="cursos">Cursos</button>
        <button class="tab-btn" data-tab="instrumentos">Instrumentos</button>
        <button class="tab-btn" data-tab="ranking">Ranking</button>
        <button class="tab-btn" data-tab="atividades">Atividades</button>
      </div>
    </div>

    <!-- 🔹 Container de conteúdo -->
    <div class="tab-content">

      <!-- Homepage -->
      <section class="tab-page active" id="home">

        <div class="hero">
          <h2>Teoria musical com flow</h2>
          <p>Aprenda afinação, ritmo e harmonia no estilo hip hop digital.</p>
          <div class="hero-ctas">
            <button class="cta" onclick="switchTab('cursos')">Começar curso</button>
            <button class="cta ghost" onclick="switchTab('instrumentos')">Abrir instrumentos</button>
          </div>
        </div>

        <div class="home-grid">
          <aside class="home-left">
            <section class="home-ranking">
              <div class="ranking-tabs">
                <button class="rk-btn active" data-period="all">Geral</button>
                <button class="rk-btn" data-period="monthly">Mensal</button>
                <button class="rk-btn" data-period="weekly">Semanal</button>
              </div>
              <div class="ranking-scroll-container">
                <table class="rk-table" id="homeRankingTable">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Usuário</th>
                      <th>Pontos</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td colspan="3" style="text-align: center; color: #666; padding: 20px;">
                        Carregando ranking...
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </section>
          </aside>

          <div class="home-right">
            <div class="deck">
              <div class="turntable">
                <img src="imgs/disc_img.png" alt="Disco de Vinil" class="disc" id="disc" draggable="false">
              </div>
              <div class="tonearm">
                <img src="imgs/tonearm_img.png" alt="Tonearm" draggable="false">
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Afinador -->
      <section class="tab-page" id="afinador">
        <div class="tuner" style="color:white; text-align:center; padding-top:40px;">
          <div class="tuner-arc" id="tunerArc"></div>
          <div class="tuner-note" id="tunerNote">--</div>
          <div class="tuner-cents" id="tunerCents"></div>
          <button id="micToggle" class="mic-btn">
            <img id="micIcon" src="imgs/mic_off_icon.png" alt="Microfone">
          </button>
        </div>
      </section>

      <!-- Cursos -->
      <section class="tab-page" id="cursos">
        <div class="course-wrapper">
          <div class="course-progress">
            <div class="course-progress-bar" id="courseProgressBar"></div>
            <span class="course-progress-text" id="courseProgressText">0% concluído</span>
          </div>

          <div class="modules">
            <div class="module-card" data-module="1">
              <div class="module-info">
                <h4>Módulo 1 — Sons agudos e graves</h4>
                <p>Iniciação à teoria musical: o que é altura, timbre e intensidade.</p>
              </div>
              <div class="module-actions">
                <span class="module-status" data-status="pending">✕</span>
                <button class="module-open">Abrir</button>
              </div>
            </div>

            <div class="module-card" data-module="2">
              <div class="module-info">
                <h4>Módulo 2 — Propriedades do Som</h4>
                <p>Duração, pulsação, ritmo, intensidade e timbre.</p>
              </div>
              <div class="module-actions">
                <span class="module-status" data-status="pending">✕</span>
                <button class="module-open">Abrir</button>
              </div>
            </div>

            <div class="module-card" data-module="3">
              <div class="module-info">
                <h4>Módulo 3 — Ritmo</h4>
                <p>Aprenda sobre a pulsação, compasso e a organização do tempo na música.</p>
              </div>
              <div class="module-actions">
                <span class="module-status" data-status="pending">✕</span>
                <button class="module-open">Abrir</button>
              </div>
            </div>

            <div class="module-card" data-module="4">
              <div class="module-info">
                <h4>Módulo 4 — Tons e Semitons</h4>
                <p>Descubra a diferença básica entre tons e semitons de forma fácil.</p>
              </div>
              <div class="module-actions">
                <span class="module-status" data-status="pending">✕</span>
                <button class="module-open">Abrir</button>
              </div>
            </div>

            <div class="module-card" data-module="5">
              <div class="module-info">
                <h4>Módulo 5 — Escala Maior</h4>
                <p>Aprenda a escala maior de forma simples, com o exemplo da escala de Dó maior.</p>
              </div>
              <div class="module-actions">
                <span class="module-status" data-status="pending">✕</span>
                <button class="module-open">Abrir</button>
              </div>
            </div>

            <div class="module-card" data-module="6">
              <div class="module-info">
                <h4>Módulo 6 — Escala Menor</h4>
                <p>Aprenda a escala menor natural, com o exemplo da escala de Lá menor.</p>
              </div>
              <div class="module-actions">
                <span class="module-status" data-status="pending">✕</span>
                <button class="module-open">Abrir</button>
              </div>
            </div>

            <div class="module-card" data-module="7">
              <div class="module-info">
                <h4>Módulo 7 — Figuras Musicais</h4>
                <p>Aprenda sobre as figuras de som e silêncio, suas durações e estruturas.</p>
              </div>
              <div class="module-actions">
                <span class="module-status" data-status="pending">✕</span>
                <button class="module-open">Abrir</button>
              </div>
            </div>

            <div class="module-card" data-module="8">
              <div class="module-info">
                <h4>Módulo 8 — Melhorando o Ritmo</h4>
                <p>Aprofunde o estudo do ritmo usando semínimas, semínimas pontuadas e a diferença entre ritmos simples
                  e compostos.</p>
              </div>
              <div class="module-actions">
                <span class="module-status" data-status="pending">✕</span>
                <button class="module-open">Abrir</button>
              </div>
            </div>

            <div class="module-card" data-module="9">
              <div class="module-info">
                <h4>Módulo 9 — Claves Musicais</h4>
                <p>Aprenda sobre as claves de Sol, Fá e Dó, fundamentais para a leitura musical.</p>
              </div>
              <div class="module-actions">
                <span class="module-status" data-status="pending">✕</span>
                <button class="module-open">Abrir</button>
              </div>
            </div>

            <div class="module-card" data-module="10">
              <div class="module-info">
                <h4>Módulo 10 — Compasso</h4>
                <p>Entenda o conceito de compasso e como ele organiza os tempos da música.</p>
              </div>
              <div class="module-actions">
                <span class="module-status" data-status="pending">✕</span>
                <button class="module-open">Abrir</button>
              </div>
            </div>

            <div class="module-card" data-module="11">
              <div class="module-info">
                <h4>Módulo 11 — Acidentes Musicais</h4>
                <p>Aprenda sobre sustenidos, bemóis e bequadros, símbolos que alteram a altura das notas.</p>
              </div>
              <div class="module-actions">
                <span class="module-status" data-status="pending">✕</span>
                <button class="module-open">Abrir</button>
              </div>
            </div>
            <div class="module-card" data-module="12">
              <div class="module-info">
                <h4>Módulo 12 — Armadura de Clave</h4>
                <p>Como ler e usar a armadura de clave: ordem de sustenidos/bemóis, relativos e círculo das quintas.</p>
              </div>
              <div class="module-actions">
                <span class="module-status" data-status="pending">✕</span>
                <button class="module-open">Abrir</button>
              </div>
            </div>

            <div class="module-card" data-module="13">
              <div class="module-info">
                <h4>Módulo 13 — Desafio Final: Partitura</h4>
                <p>Identifique corretamente as notas musicais em uma partitura.</p>
              </div>
              <div class="module-actions">
                <span class="module-status" data-status="pending">✕</span>
                <button class="module-open">Abrir</button>
              </div>
            </div>


          </div>

          <div class="lesson-panel hidden" id="lessonPanel">
            <button class="lesson-close" id="lessonClose">Fechar</button>
            <div class="lesson-content" id="lessonContent"></div>
          </div>
        </div>
      </section>

      <!-- Instrumentos -->
      <section class="tab-page" id="instrumentos">
        <div id="virtual-piano-container">
          <div class="instrument-selector">
            <button class="inst-btn active" data-inst="piano">Piano Virtual</button>
            <button class="inst-btn" data-inst="guitar">Violão Acústico Virtual</button>
            <button class="inst-btn" data-inst="drums">Bateria</button>
            <button class="inst-btn" data-inst="flute">Flauta</button>
          </div>

          <div id="instrument-area">
            <div id="piano-scroll">
              <div id="virtual-piano"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- Ranking Completo -->
      <section class="tab-page" id="ranking">
        <div class="ranking-full">
          <h2 style="color: #fff; text-align: center; margin-bottom: 20px; font-size: 32px;">Ranking Global</h2>

          <div class="ranking-tabs">
            <button class="rk-btn active" data-period="all">Geral</button>
            <button class="rk-btn" data-period="monthly">Mensal</button>
            <button class="rk-btn" data-period="weekly">Semanal</button>
          </div>

          <div class="ranking-scroll-container">
            <table class="rk-table" id="fullRankingTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Usuário</th>
                  <th>Pontos</th>
                  <th>Última Atividade</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="4" style="text-align: center; color: #666; padding: 40px;">
                    Carregando ranking completo...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>


      <!-- Atividades -->
      <section class="tab-page" id="atividades">
        <h2 style="color:white; text-align:center; margin-bottom:20px;">Atividades</h2>

        <div class="activities-grid">
          <!-- Card 1 - Agudo x Grave -->
          <div class="activity-card" onclick="openActivity('agudoGrave')">
            <img src="imgs/agudo_grave.jpg" alt="Agudo ou Grave">
            <h3>Agudo ou Grave</h3>
          </div>

          <!-- Card 2 - Duração: Longo ou Curto -->
          <div class="activity-card" onclick="openActivity('duracao')">
            <img src="imgs/figs.jpg" alt="Duração: Longo ou Curto">
            <h3>Duração: Longo ou Curto</h3>
          </div>

          <!-- Card 3 - Intensidade: Forte ou Fraco -->
          <div class="activity-card" onclick="openActivity('intensidade')">
            <img src="imgs/compasso_img.jpg" alt="Intensidade: Forte ou Fraco">
            <h3>Intensidade: Forte ou Fraco</h3>
          </div>
        </div>
      </section>

      <!-- Modal para Atividades -->
      <div id="activityModal" class="activity-modal hidden">
        <div class="activity-content">
          <span class="close-btn" onclick="closeActivity()">&times;</span>
          <div id="activityInner"></div>
        </div>
      </div>

    </div>

  </main>

  <div class="music-popup" id="musicPopup">
    <p>Nome da Música - Artista</p>
  </div>

  <!-- Modal de Edição de Perfil -->
  <div class="profile-modal" id="profileModal">
    <div class="profile-modal-content">
      <div class="profile-modal-header">
        <h3>Editar Perfil</h3>
        <button class="close-modal" id="closeProfileModal">&times;</button>
      </div>

      <form class="profile-form" id="profileForm">
        <div class="profile-picture">
          <img id="profilePicture" src="" alt="Foto do perfil">
          <button type="button" class="upload-btn" id="uploadPicture">Alterar Foto</button>
          <input type="file" id="pictureInput" accept="image/*" style="display: none;">
        </div>

        <div class="form-group">
          <label for="displayName">Nome de Exibição</label>
          <input type="text" id="displayName" name="displayName" required>
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" readonly>
        </div>

        <div class="form-group">
          <label for="currentPassword">Senha Atual</label>
          <input type="password" id="currentPassword" name="currentPassword">
        </div>

        <div class="form-group">
          <label for="newPassword">Nova Senha</label>
          <input type="password" id="newPassword" name="newPassword">
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirmar Nova Senha</label>
          <input type="password" id="confirmPassword" name="confirmPassword">
        </div>

        <div class="profile-actions">
          <button type="button" class="profile-btn secondary" id="cancelProfile">Cancelar</button>
          <button type="submit" class="profile-btn primary">Salvar Alterações</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <script>
    const firebaseConfig = {

      apiKey: "AIzaSyCZ7am6qEWa5-X-12FCLkqU5X5QcEBkZ7s",

      authDomain: "edutainment-db.firebaseapp.com",

      databaseURL: "https://edutainment-db-default-rtdb.firebaseio.com",

      projectId: "edutainment-db",

      storageBucket: "edutainment-db.firebasestorage.app",

      messagingSenderId: "86651784570",

      appId: "1:86651784570:web:64a18f58ed5e5636711ac3",

      measurementId: "G-FQ450KT41Q"

    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const provider = new firebase.auth.GoogleAuthProvider();
    const db = firebase.firestore(); // 🎉 Adicione esta linha!
  </script>


  <script src="script.js"></script>

  <!-- Debug script for PWA testing -->
  <script>
    // Debug básico que funciona independente do script principal
    console.log('=== PWA DEBUG INICIANDO ===');

    // Função global de debug
    window.debugPWA = function () {
      console.log('🔍 PWA STATUS:');
      console.log('• Service Worker:', 'serviceWorker' in navigator ? '✅' : '❌');
      console.log('• BeforeInstallPrompt:', 'onbeforeinstallprompt' in window ? '✅' : '❌');
      console.log('• Manifest Link:', 'manifest' in document.createElement('link') ? '✅' : '❌');
      console.log('• Standalone Mode:', window.matchMedia('(display-mode: standalone)').matches ? '✅' : '❌');

      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(function (regs) {
          console.log('• SW Registrations:', regs.length);
          regs.forEach(function (reg, i) {
            console.log('  -', reg.scope, reg.active ? '(ativo)' : '(inativo)');
          });
        });
      }

      fetch('./manifest.json').then(function (r) {
        return r.json();
      }).then(function (m) {
        console.log('• Manifest:', m.name, '(' + m.icons.length + ' ícones)');
      }).catch(function (e) {
        console.log('• Manifest Error:', e.message);
      });
    };

    // Executar automaticamente
    setTimeout(function () {
      console.log('=== VERIFICAÇÃO AUTOMÁTICA DA PWA ===');
      debugPWA();
    }, 500);
  </script>
</body>


</html>
